{"version":3,"sources":["webpack:///./gesture.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/startup"],"names":["element","document","documentElement","isListeningMouse","Dispatcher","type","properties","event","Event","key","hasOwnProperty","value","dispatchEvent","Listener","recognizer","addEventListener","context","Object","create","contexts","set","button","start","mousemove","buttons","get","move","mouseup","end","buttonss","removeEventListener","Map","changedTouches","touch","identifier","cancel","Recognizer","dispatcher","point","startX","clientX","startY","clientY","points","t","Date","now","x","y","isTap","isPan","isPress","isFlick","handler","setTimeout","dispatch","dx","dy","isVertical","Math","abs","clearTimeout","filter","push","d","v","length","sqrt","velocity","enableGesture"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,OAAO,GAAGC,QAAQ,CAACC,eAAvB;AACA,IAAIC,gBAAgB,GAAG,KAAvB,C,CAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAMC,UAAb;AACE,sBAAYJ,OAAZ,EAAqB;AAAA;;AACnB,SAAKA,OAAL,GAAeA,OAAf;AACD;;AAHH;AAAA;AAAA,6BAIWK,IAJX,EAIiBC,UAJjB,EAI6B;AACzB,UAAIC,KAAK,GAAG,IAAIC,KAAJ,CAAUH,IAAV,CAAZ;;AACA,WAAK,IAAMI,GAAX,IAAkBH,UAAlB,EAA8B;AAC5B,YAAIA,UAAU,CAACI,cAAX,CAA0BD,GAA1B,CAAJ,EAAoC;AAClC,cAAME,KAAK,GAAGL,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","file":"main.js","sourcesContent":["let element = document.documentElement;\r\nlet isListeningMouse = false;\r\n\r\n// listen => recognize => dispatch\r\n// new Listener(new Recognizer(dispatch))\r\n\r\n// document.addEventListener('mousedown', (event) => {\r\n//   // 按下哪个键\r\n//   console.log(event.button);\r\n\r\n//   let context = Object.create(null);\r\n//   contexts.set('mouse' + (1 << event.button), context);\r\n\r\n//   start(event, context);\r\n//   let mousemove = (event) => {\r\n//     // 掩码，二进制表示，0b0001左键按下\r\n//     // event.buttons=== 0b0001\r\n//     let button = 1;\r\n//     while (button <= event.buttons) {\r\n//       if (button & event.buttons) {\r\n//         // 鼠标中键和右键顺序不一致，需要调整\r\n//         let key;\r\n//         if (button === 2) key = 4;\r\n//         else if (button === 4) key = 2;\r\n//         else key = button;\r\n//         let context = contexts.get('mouse' + key);\r\n//         move(event, context);\r\n//       }\r\n//       button = button << 1;\r\n//     }\r\n//   };\r\n//   let mouseup = (event) => {\r\n//     console.log(event.button);\r\n//     let context = contexts.get('mouse' + (1 << event.button));\r\n//     end(event, context);\r\n//     contexts.delete('mouse' + (1 << event.button));\r\n//     if (event.buttons === 0) {\r\n//       document.removeEventListener('mousemove', mousemove);\r\n//       document.removeEventListener('mouseup', mouseup);\r\n//       isListeningMouse = false;\r\n//     }\r\n//   };\r\n//   if (!isListeningMouse) {\r\n//     document.addEventListener('mousemove', mousemove);\r\n//     document.addEventListener('mouseup', mouseup);\r\n//     isListeningMouse = true;\r\n//   }\r\n// });\r\n\r\n// let contexts = new Map();\r\n\r\n// document.addEventListener('touchstart', (event) => {\r\n//   for (let touch of event.changedTouches) {\r\n//     let context = Object.create(null);\r\n//     contexts.set(touch.identifier, context);\r\n//     start(touch, context);\r\n//   }\r\n// });\r\n// document.addEventListener('touchmove', (event) => {\r\n//   for (let touch of event.changedTouches) {\r\n//     let context = contexts.get(touch.identifier);\r\n//     move(touch, context);\r\n//   }\r\n// });\r\n// document.addEventListener('touchend', (event) => {\r\n//   for (let touch of event.changedTouches) {\r\n//     let context = contexts.get(touch.identifier);\r\n//     end(touch, context);\r\n//     contexts.delete(touch.identifier);\r\n//   }\r\n// });\r\n// document.addEventListener('touchcancel', (event) => {\r\n//   for (let touch of event.changedTouches) {\r\n//     let context = contexts.get(touch.identifier);\r\n//     cancel(touch, context);\r\n//   }\r\n// });\r\n\r\n// let handler;\r\n// let startX, startY;\r\n// let isPan = false,\r\n//   isTap = true,\r\n//   isPress = false;\r\n\r\n// let start = (point, context) => {\r\n//   // console.log('start', point.clientX, point.clientY);\r\n//   (context.startX = point.clientX), (context.startY = point.clientY);\r\n//   context.points = [\r\n//     {\r\n//       t: Date.now(),\r\n//       x: point.clientX,\r\n//       y: point.clientY,\r\n//     },\r\n//   ];\r\n//   context.isTap = true;\r\n//   context.isPan = false;\r\n//   context.isPress = false;\r\n//   context.handler = setTimeout(() => {\r\n//     context.isTap = false;\r\n//     context.isPan = false;\r\n//     context.isPress = true;\r\n//     context.handler = null;\r\n//     console.log('pressstart');\r\n//   }, 500);\r\n// };\r\n\r\n// let move = (point, context) => {\r\n//   let dx = point.clientX - context.startX,\r\n//     dy = point.clientY - context.startY;\r\n//   // 移动超过10px\r\n//   if (!context.isPan && dx ** 2 + dy ** 2 > 100) {\r\n//     context.isTap = false;\r\n//     context.isPan = true;\r\n//     context.isPress = false;\r\n//     clearTimeout(context.handler);\r\n//   }\r\n//   if (context.isPan) {\r\n//     console.log(dx, dy);\r\n//     console.log('pan');\r\n//   }\r\n//   context.points = context.points.filter((point) => Date.now() - point.t < 500);\r\n//   context.points.push({\r\n//     t: Date.now(),\r\n//     x: point.clientX,\r\n//     y: point.clientY,\r\n//   });\r\n//   // console.log('move', point.clientX, point.clientY);\r\n// };\r\n\r\n// let end = (point, context) => {\r\n//   if (context.isTap) {\r\n//     console.log('tap');\r\n//     dispatch('tap', {});\r\n//     clearTimeout(context.handler);\r\n//   }\r\n//   if (context.isPan) {\r\n//     console.log('paned');\r\n//   }\r\n//   if (context.isPress) {\r\n//     console.log('presseend');\r\n//   }\r\n//   context.points = context.points.filter((point) => Date.now() - point.t < 500);\r\n//   let d, v;\r\n//   if (!context.points.length) {\r\n//     v = 0;\r\n//   } else {\r\n//     // 移动的距离\r\n//     d = Math.sqrt(\r\n//       (point.clientX - context.points[0].x) ** 2 + (point.clientY - context.points[0].y) ** 2\r\n//     );\r\n//     // 速度\r\n//     v = d / (Date.now() - context.points[0].t);\r\n//     console.log(v);\r\n//   }\r\n//   // 像素每毫秒\r\n//   if (v > 1.5) {\r\n//     console.log('flick');\r\n//     context.isFlick = true;\r\n//   } else {\r\n//     context.isFlick = false;\r\n//   }\r\n//   // console.log('end', point.clientX, point.clientY);\r\n// };\r\n// let cancel = (point, context) => {\r\n//   clearTimeout(context.handler);\r\n//   // console.log('cancel', point.clientX, point.clientY);\r\n// };\r\n\r\n// function dispatch(type, properties) {\r\n//   let event = new CustomEvent(type);\r\n//   for (let name in properties) {\r\n//     event[name] = properties[name];\r\n//   }\r\n//   element.dispatchEvent(event);\r\n// }\r\nexport class Dispatcher {\r\n  constructor(element) {\r\n    this.element = element;\r\n  }\r\n  dispatch(type, properties) {\r\n    let event = new Event(type);\r\n    for (const key in properties) {\r\n      if (properties.hasOwnProperty(key)) {\r\n        const value = properties[key];\r\n        event[key] = value;\r\n      }\r\n    }\r\n    this.element.dispatchEvent(event);\r\n  }\r\n}\r\n\r\nexport class Listener {\r\n  constructor(element, recognizer) {\r\n    let isListeningMouse = false;\r\n    element.addEventListener('mousedown', (event) => {\r\n      let context = Object.create(null);\r\n      contexts.set('mouse' + (1 << event.button), context);\r\n      recognizer.start(event, context);\r\n      let mousemove = (event) => {\r\n        let button = 1;\r\n        while (button <= event.buttons) {\r\n          if (button & event.buttons) {\r\n            let key;\r\n            if (button === 2) {\r\n              key = 4;\r\n            } else if (button === 4) {\r\n              key = 2;\r\n            } else {\r\n              key = button;\r\n            }\r\n            let context = contexts.get('mouse' + key);\r\n            recognizer.move(event, context);\r\n          }\r\n          button = button << 1;\r\n        }\r\n      };\r\n      let mouseup = (event) => {\r\n        let context = contexts.get('mouse' + (1 << event.button));\r\n        recognizer.end(event, context);\r\n        contexts.delete('mouse' + (1 << event.button));\r\n        if (event.buttonss === 0) {\r\n          document.removeEventListener('mousemove', mousemove);\r\n          document.removeEventListener('mouseup', mouseup);\r\n          isListeningMouse = false;\r\n        }\r\n      };\r\n      if (!isListeningMouse) {\r\n        document.addEventListener('mousemove', mousemove);\r\n        document.addEventListener('mouseup', mouseup);\r\n        isListeningMouse = true;\r\n      }\r\n    });\r\n\r\n    let contexts = new Map();\r\n    element.addEventListener('touchstart', (event) => {\r\n      for (const touch of event.changedTouches) {\r\n        let context = Object.create(null);\r\n        contexts.set(touch.identifier, context);\r\n        recognizer.start(touch, context);\r\n      }\r\n    });\r\n    element.addEventListener('touchmove', (event) => {\r\n      for (const touch of event.changedTouches) {\r\n        let context = contexts.get(touch.identifier);\r\n        recognizer.move(touch, context);\r\n      }\r\n    });\r\n    element.addEventListener('touchend', (event) => {\r\n      for (const touch of event.changedTouches) {\r\n        let context = contexts.get(touch.identifier);\r\n        recognizer.end(touch, context);\r\n        contexts.delete(touch.identifier);\r\n      }\r\n    });\r\n    element.addEventListener('touchcancel', (event) => {\r\n      for (const touch of event.changedTouches) {\r\n        let context = contexts.get(touch.identifier);\r\n        recognizer.cancel(touch, context);\r\n        contexts.delete(touch.identifier);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport class Recognizer {\r\n  constructor(dispatcher) {\r\n    this.dispatcher = dispatcher;\r\n  }\r\n  start(point, context) {\r\n    (context.startX = point.clientX), (context.startY = point.clientY);\r\n    context.points = [\r\n      {\r\n        t: Date.now(),\r\n        x: point.clientX,\r\n        y: point.clientY,\r\n      },\r\n    ];\r\n    context.isTap = true;\r\n    context.isPan = false;\r\n    context.isPress = false;\r\n    context.isFlick = false;\r\n    // 判断press超过500毫秒\r\n    context.handler = setTimeout(() => {\r\n      context.isTap = false;\r\n      context.isPan = false;\r\n      context.isPress = true;\r\n      context.handler = null;\r\n      this.dispatcher.dispatch('press', {});\r\n    }, 500);\r\n  }\r\n  move(point, context) {\r\n    let dx = point.clientX - context.startX,\r\n      dy = point.clientY - context.startY;\r\n    // 移动超过10px 取消press监听\r\n    if (!context.isPan && dx ** 2 + dy ** 2 > 100) {\r\n      context.isTap = false;\r\n      context.isPress = false;\r\n      context.isPan = true;\r\n      context.isVertical = Math.abs(dx) < Math.abs(dy);\r\n      this.dispatcher.dispatch('panstart', {\r\n        startX: context.startX,\r\n        startY: context.startY,\r\n        clientX: point.clientX,\r\n        clientY: point.clientY,\r\n        isVertical: context.isVertical,\r\n      });\r\n      clearTimeout(context.handler);\r\n    }\r\n    if (context.isPan) {\r\n      //平移\r\n      this.dispatcher.dispatch('pan', {\r\n        startX: context.startX,\r\n        startY: context.startY,\r\n        clientX: point.clientX,\r\n        clientY: point.clientY,\r\n        isVertical: context.isVertical,\r\n      });\r\n    }\r\n\r\n    context.points = context.points.filter((point) => Date.now() - point.t < 500);\r\n    context.points.push({\r\n      t: Date.now(),\r\n      x: point.clientX,\r\n      y: point.clientY,\r\n    });\r\n  }\r\n  end(point, context) {\r\n    if (context.isTap) {\r\n      this.dispatcher.dispatch('tap', {});\r\n      clearTimeout(context.handler);\r\n    }\r\n    if (context.isPress) {\r\n      this.dispatcher.dispatch('pressend', {});\r\n    }\r\n    context.points = context.points.filter((point) => Date.now() - point.t < 500);\r\n    let d, v;\r\n    if (!context.points.length) {\r\n      v = 0;\r\n    } else {\r\n      d = Math.sqrt(\r\n        (point.clientX - context.points[0].x) ** 2 + (point.clientY - context.points[0].y) ** 2\r\n      );\r\n      v = d / (Date.now() - context.points[0].t);\r\n    }\r\n\r\n    if (v > 1.5) {\r\n      this.dispatcher.dispatch('flick', {\r\n        startX: context.startX,\r\n        startY: context.startY,\r\n        clientX: point.clientX,\r\n        clientY: point.clientY,\r\n        isVertical: context.isVertical,\r\n        isFlick: context.isFlick,\r\n        velocity: v,\r\n      });\r\n      context.isFlick = true;\r\n    } else {\r\n      context.isFlick = false;\r\n    }\r\n    if (context.isPan) {\r\n      this.dispatcher.dispatch('panend', {\r\n        startX: context.startX,\r\n        startY: context.startY,\r\n        clientX: point.clientX,\r\n        clientY: point.clientY,\r\n        isVertical: context.isVertical,\r\n        isFlick: context.isFlick,\r\n      });\r\n    }\r\n  }\r\n  cancel(point, context) {\r\n    this.dispatcher.dispatch('cancel', {});\r\n  }\r\n}\r\n\r\nexport function enableGesture(element) {\r\n  new Listener(element, new Recognizer(new Dispatcher(element)));\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module\n__webpack_require__(\"./gesture.js\");\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}